<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Contest System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="datetime-local"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .question-list {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        .question-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: flex-start;
        }
        .question-item:last-child {
            border-bottom: none;
        }
        .question-details {
            margin-left: 10px;
            flex-grow: 1;
        }
        .question-title {
            font-weight: bold;
        }
        .question-difficulty {
            font-size: 0.9em;
            color: #666;
        }
        .question-tags {
            margin-top: 5px;
            font-size: 0.85em;
        }
        .tag {
            display: inline-block;
            background-color: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 3px;
        }
        .selected-questions {
            margin-top: 20px;
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            display: none;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .filters select {
            flex: 1;
        }
        .difficulty-800, .difficulty-900, .difficulty-1000, .difficulty-1100, .difficulty-1200 {
            color: green;
        }
        .difficulty-1300, .difficulty-1400, .difficulty-1500, .difficulty-1600, .difficulty-1700, .difficulty-1800, .difficulty-1900 {
            color: orange;
        }
        .difficulty-2000, .difficulty-2100, .difficulty-2200, .difficulty-2300, .difficulty-2400, .difficulty-2500, .difficulty-2600, .difficulty-2700, .difficulty-2800, .difficulty-2900, .difficulty-3000, .difficulty-3100, .difficulty-3200, .difficulty-3300, .difficulty-3400, .difficulty-3500 {
            color: red;
        }
        
        #createContestPage, #contestViewPage {
            transition: opacity 0.3s ease-in-out;
        }
        #contestViewPage {
            display: none;
        }
        .contest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .timer-box {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        .timer-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        .problem-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .problem-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .problem-card-title {
            font-size: 1.2em;
            font-weight: bold;
        }
        .problem-card-difficulty {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .problem-tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .contest-status {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .not-started {
            color: #f39c12;
        }
        .in-progress {
            color: #27ae60;
        }
        .ended {
            color: #e74c3c;
        }
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="createContestPage">
        <h1>Create Custom Contest</h1>
        
        <form id="contestForm">
            <div class="form-group">
                <label for="contestName">Contest Name:</label>
                <input type="text" id="contestName" required>
            </div>
            
            <div class="form-group">
                <label for="startDateTime">Start Date and Time:</label>
                <input type="datetime-local" id="startDateTime" required>
            </div>
            
            <div class="form-group">
                <label for="endDateTime">End Date and Time:</label>
                <input type="datetime-local" id="endDateTime" required>
            </div>
            
            <div class="form-group">
                <label>Problem Filters:</label>
                <div class="filters">
                    <select id="tagFilter">
                        <option value="">All Tags</option>
                       
                    </select>
                    <select id="difficultyFilter">
                        <option value="">All Difficulties</option>
                        <option value="800-1200">Easy (800-1200)</option>
                        <option value="1300-1900">Medium (1300-1900)</option>
                        <option value="2000+">Hard (2000+)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Select Problems (at least one required):</label>
                <div class="question-list" id="questionList">
                    <div class="loading" id="loadingProblems">Loading problems from Codeforces...</div>
                </div>
                <div class="error-message" id="questionError">Please select at least one problem.</div>
            </div>
            
            <div class="form-group selected-questions">
                <label>Selected Problems:</label>
                <div id="selectedQuestions">None selected</div>
            </div>
            
            <button type="submit">Create Contest</button>
        </form>
    </div>

      <!-- Sidebar -->
<div class="sidebar">
    <!-- Existing buttons or content -->
    <button id="leaderboardBtn">Leaderboard</button>
    <button id="inviteFriendsBtn">Invite Friends</button>
</div>

    <div id="contestViewPage">
        <div class="contest-header">
            <h1 id="contestViewTitle">Contest Name</h1>
            <button id="backToCreate">Edit Contest</button>
        </div>
        
        <div class="contest-status" id="contestStatus">Contest not started yet</div>
        
        <div class="timer-box">
            <div id="timerLabel">Time until contest starts:</div>
            <div class="timer-value" id="timerValue">00:00:00:00</div>
        </div>
        
        <h2>Problems</h2>
        <div id="problemsList">
          
        </div>
        
        <div class="action-buttons">
            <button id="startContestNow">Start Contest Now</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
           
            const createContestPage = document.getElementById('createContestPage');
            const contestViewPage = document.getElementById('contestViewPage');
            const questionList = document.getElementById('questionList');
            const selectedQuestions = document.getElementById('selectedQuestions');
            const form = document.getElementById('contestForm');
            const questionError = document.getElementById('questionError');
            const loadingProblems = document.getElementById('loadingProblems');
            const tagFilter = document.getElementById('tagFilter');
            const difficultyFilter = document.getElementById('difficultyFilter');
            const backToCreateBtn = document.getElementById('backToCreate');
            const startContestNowBtn = document.getElementById('startContestNow');
            
        
            const contestViewTitle = document.getElementById('contestViewTitle');
            const contestStatus = document.getElementById('contestStatus');
            const timerLabel = document.getElementById('timerLabel');
            const timerValue = document.getElementById('timerValue');
            const problemsList = document.getElementById('problemsList');
            
            const selectedQuestionsSet = new Set();
            let allProblems = [];
            let allTags = new Set();
            let contestData = null;
            let timerInterval = null;
            
           
            async function fetchProblems() {
                try {
                    const response = await fetch('https://codeforces.com/api/problemset.problems');
                    const data = await response.json();
                    
                    if (data.status === 'OK') {
                        allProblems = data.result.problems.map(problem => {
                            return {
                                id: `${problem.contestId}-${problem.index}`,
                                name: problem.name,
                                rating: problem.rating || 0,
                                tags: problem.tags || [],
                                contestId: problem.contestId,
                                index: problem.index
                            };
                        });
                        
                        
                        allProblems.forEach(problem => {
                            problem.tags.forEach(tag => allTags.add(tag));
                        });
                        
                        
                        allProblems.sort((a, b) => a.rating - b.rating);
                        
                       
                        populateTagFilter();
                        
                       
                        displayProblems();
                    } else {
                        questionList.innerHTML = '<div class="error-message">Failed to load problems from Codeforces</div>';
                    }
                } catch (error) {
                    console.error('Error fetching problems:', error);
                    questionList.innerHTML = '<div class="error-message">Failed to load problems from Codeforces. Please try again later.</div>';
                }
            }
            
           
            function populateTagFilter() {
                const sortedTags = [...allTags].sort();
                sortedTags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag;
                    option.textContent = tag;
                    tagFilter.appendChild(option);
                });
            }
            
            
            function displayProblems() {
                loadingProblems.style.display = 'none';
                questionList.innerHTML = '';
                
                const selectedTag = tagFilter.value;
                const selectedDifficulty = difficultyFilter.value;
                
            
                let filteredProblems = allProblems.filter(problem => {
                   
                    if (selectedTag && !problem.tags.includes(selectedTag)) {
                        return false;
                    }
                    
               
                    if (selectedDifficulty) {
                        if (selectedDifficulty === '800-1200' && (problem.rating < 800 || problem.rating > 1200)) {
                            return false;
                        } else if (selectedDifficulty === '1300-1900' && (problem.rating < 1300 || problem.rating > 1900)) {
                            return false;
                        } else if (selectedDifficulty === '2000+' && problem.rating < 2000) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
               
                filteredProblems = filteredProblems.slice(0, 100);
                
                if (filteredProblems.length === 0) {
                    questionList.innerHTML = '<div>No problems match the selected filters</div>';
                    return;
                }
                
               
                filteredProblems.forEach(problem => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'question-item';
                    
                   
                    let difficultyText = 'Unknown';
                    let difficultyClass = '';
                    
                    if (problem.rating) {
                        difficultyText = `Difficulty: ${problem.rating}`;
                        difficultyClass = `difficulty-${problem.rating}`;
                    }
                    
                   
                    const tagsHtml = problem.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                    
                    questionItem.innerHTML = `
                        <input type="checkbox" id="question-${problem.id}" data-id="${problem.id}" ${selectedQuestionsSet.has(problem.id) ? 'checked' : ''}>
                        <div class="question-details">
                            <div class="question-title">${problem.name}</div>
                            <div class="question-difficulty ${difficultyClass}">${difficultyText}</div>
                            <div>Contest: ${problem.contestId}, Problem: ${problem.index}</div>
                            <div class="question-tags">${tagsHtml}</div>
                        </div>
                    `;
                    
                    questionList.appendChild(questionItem);
                    
                
                    const checkbox = questionItem.querySelector(`#question-${problem.id}`);
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            selectedQuestionsSet.add(problem.id);
                        } else {
                            selectedQuestionsSet.delete(problem.id);
                        }
                        updateSelectedQuestions();
                    });
                });
            }
            
           
            function updateSelectedQuestions() {
                if (selectedQuestionsSet.size === 0) {
                    selectedQuestions.textContent = 'None selected';
                } else {
                    selectedQuestions.innerHTML = '';
                    Array.from(selectedQuestionsSet).forEach(id => {
                        const problem = allProblems.find(p => p.id === id);
                        if (problem) {
                            const item = document.createElement('div');
                            item.textContent = `${problem.name} (Rating: ${problem.rating || 'Unknown'})`;
                            selectedQuestions.appendChild(item);
                        }
                    });
                }
            }
            
            
            function formatTime(timeInMs) {
                if (timeInMs < 0) return "00:00:00:00";
                
                const seconds = Math.floor((timeInMs / 1000) % 60);
                const minutes = Math.floor((timeInMs / (1000 * 60)) % 60);
                const hours = Math.floor((timeInMs / (1000 * 60 * 60)) % 24);
                const days = Math.floor(timeInMs / (1000 * 60 * 60 * 24));
                
                return `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            if (!contestData) {
    console.error("contestData is null! Initializing...");
    contestData = {}; // Or set a default object with expected properties
}

            console.log("Start Time:", contestData.startDateTime);
            console.log("End Time:", contestData.endDateTime);
            console.log("Current Time:", new Date());

            
            function updateTimer() {
    if (!contestData.startDateTime || !contestData.endDateTime) {
        console.error("Contest start or end time is missing!");
        return;
    }

    const now = new Date();
    const startTime = new Date(contestData.startDateTime);
    const endTime = new Date(contestData.endDateTime); // ✅ Declare before using it

    console.log("Updating Timer:", endTime - now);  // ✅ Now `endTime` is defined

    if (now < startTime) {
        const timeUntilStart = startTime - now;
        timerLabel.textContent = "Time until contest starts:";
        timerValue.textContent = formatTime(timeUntilStart);
        contestStatus.textContent = "Contest not started yet";
        contestStatus.className = "contest-status not-started";
        startContestNowBtn.style.display = "block";
    } else if (now >= startTime && now < endTime) {
        const timeUntilEnd = endTime - now;
        timerLabel.textContent = "Time remaining:";
        timerValue.textContent = formatTime(timeUntilEnd);
        contestStatus.textContent = "Contest in progress";
        contestStatus.className = "contest-status in-progress";
        startContestNowBtn.style.display = "none";
    } else {
        timerLabel.textContent = "Contest ended";
        timerValue.textContent = "00:00:00:00";
        contestStatus.textContent = "Contest has ended";
        contestStatus.className = "contest-status ended";
        startContestNowBtn.style.display = "none";

        clearInterval(timerInterval);
    }
}

            function showContestView() {
               
                contestViewTitle.textContent = contestData.name;
                
               
                problemsList.innerHTML = '';
                
               
                contestData.selectedProblems.forEach(problem => {
                    const problemCard = document.createElement('div');
                    problemCard.className = 'problem-card';
                    
                   
                    let difficultyClass = '';
                    if (problem.rating <= 1200) difficultyClass = 'difficulty-800';
                    else if (problem.rating <= 1900) difficultyClass = 'difficulty-1300';
                    else difficultyClass = 'difficulty-2000';
                    
                   
                    const tagsHtml = problem.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                    
                    problemCard.innerHTML = `
                        <div class="problem-card-header">
                            <div class="problem-card-title">${problem.name}</div>
                            <div class="problem-card-difficulty ${difficultyClass}">Rating: ${problem.rating || 'Unknown'}</div>
                        </div>
                        <div>Problem ${problem.index} from Contest ${problem.contestId}</div>
                        <div class="problem-tags-list">${tagsHtml}</div>
                        <div style="margin-top: 10px;">
                            <a href="https://codeforces.com/problemset/problem/${problem.contestId}/${problem.index}" target="_blank">Solve on Codeforces</a>
                        </div>
                    `;
                    
                    problemsList.appendChild(problemCard);
                });
                
              
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
                
                
                createContestPage.style.display = 'none';
                contestViewPage.style.display = 'block';
            }
            
      
            tagFilter.addEventListener('change', displayProblems);
            difficultyFilter.addEventListener('change', displayProblems);
            
          
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
               
                if (selectedQuestionsSet.size === 0) {
                    questionError.style.display = 'block';
                    return;
                }
                
               
                const startDateTime = new Date(document.getElementById('startDateTime').value);
                const endDateTime = new Date(document.getElementById('endDateTime').value);
                
                if (startDateTime >= endDateTime) {
                    alert('End date must be after start date');
                    return;
                }
                
               
                contestData = {
                    name: document.getElementById('contestName').value,
                    startDateTime: startDateTime,
                    endDateTime: endDateTime,
                    selectedProblems: Array.from(selectedQuestionsSet).map(id => {
                        return allProblems.find(p => p.id === id);
                    })
                };
                
              
                console.log('Contest created:', contestData);
                
               
                showContestView();
            });
            
          
            backToCreateBtn.addEventListener('click', function()
             {
               
                clearInterval(timerInterval);
                
               
                contestViewPage.style.display = 'none';
                createContestPage.style.display = 'block';
            });
            
           
            startContestNowBtn.addEventListener('click', function() {
    const now = new Date();
    const scheduledStartTime = new Date(contestData.startDateTime);

    if (now < scheduledStartTime) {
        alert("The contest has not started yet. Please wait until the scheduled start time.");
        return;
    }

    // Only start the contest if the current time is after the scheduled start time
    contestData.startDateTime = now;
    const originalDuration = contestData.endDateTime - scheduledStartTime;
    contestData.endDateTime = new Date(now.getTime() + originalDuration);

    updateTimer();
});
            
           
 fetchProblems();
        });
    </script>
</body>
</html>

